/*
 * Init.c
 *
 *  Created on: Jul 9, 2015
 *      Author: ddtdanilo
 */

/* Include shared modules, which are used for whole project */
#include "PE_Types.h"
#include "PE_Error.h"
#include "PE_Const.h"
#include "IO_Map.h"

/*Mis includes*/
#include "xSub.h"

/*I2C*/

byte MPU6050_ACCEL_CONFIG = 0x1C;   // R/W
byte MPU6050_AFS_SEL_4G = 0x08; //Config para +-4G
byte MPU6050_GYRO_CONFIG = 0x1B; //R/W
byte MPU6050_FS_SEL_1000 = 0x10; //Config para +-1000º/s
byte MPU = 0x68;  // I2C address of the MPU-6050
byte HMC6352 = 0x21;  // I2C address of the HMC6352 Compass

/*Puerto Serial*/
byte SIZEBUFFERIN = 5;
byte SIZEBUFFEROUT = 27;

/*Constantes de Motores*/
word CENTERDC = 0xED71; //7.2432% = 0xFFFF-0x128A = 65536-4747
word MAXFORWARD = 59162;
word MAXBACKWARD = 62200;
//word MINSERVOUS = 500;
//word MAXSERVOUS = 3000;
word MINSERVOUS = 900; //useg
word MAXSERVOUS = 3300; //useg


/*Variables físicas*/
byte  SIZEPACKAGE = 27;

vFisica8  STATUS;
vFisica16 tempExterna;
vFisica16 tempInterna;
vFisica16 presExterna;
vFisica16 aceleracionX;
vFisica16 aceleracionY;
vFisica16 aceleracionZ;
vFisica16 velAngularX;
vFisica16 velAngularY;
vFisica16 velAngularZ;
vFisica16 velLineal;
vFisica16 angBrujula;
vFisica8  presenciaAgua;
vFisica8  cargaBaterias;
vFisica8  XOR;
vFisica8  finTrama;

void initVFisicas(){
	//Genera la numeración de la posición
	STATUS.pos = 0;
	tempExterna.HIGH.pos = 1;
	tempExterna.LOW.pos = 2;
	tempInterna.HIGH.pos = 3;
	tempInterna.LOW.pos = 4;
	presExterna.HIGH.pos = 5;
	presExterna.LOW.pos = 6;
	aceleracionX.HIGH.pos = 7;
	aceleracionX.LOW.pos = 8;
	aceleracionY.HIGH.pos = 9;
	aceleracionY.LOW.pos = 10;
	aceleracionZ.HIGH.pos = 11;
	aceleracionZ.LOW.pos = 12;
	velAngularX.HIGH.pos = 13;
	velAngularX.LOW.pos = 14;
	velAngularY.HIGH.pos = 15;
	velAngularY.LOW.pos = 16;
	velAngularZ.HIGH.pos = 17;
	velAngularZ.LOW.pos = 18;
	velLineal.HIGH.pos = 19;
	velLineal.LOW.pos = 20;
	angBrujula.HIGH.pos = 21;
	angBrujula.LOW.pos = 22;
	presenciaAgua.pos = 23;
	cargaBaterias.pos = 24;
	XOR.pos = 25;
	finTrama.pos = 26;
}

void vFisicas2Array(){
	
	data[0] = STATUS.data;
	data[1] = tempExterna.HIGH.data;
	data[2] = tempExterna.LOW.data;
	data[3] = tempInterna.HIGH.data;
	data[4] = tempInterna.LOW.data;
	data[5] = presExterna.HIGH.data;
	data[6] = presExterna.LOW.data;
	data[7] = aceleracionX.HIGH.data;
	data[8] = aceleracionX.LOW.data;
	data[9] = aceleracionY.HIGH.data;
	data[10] = aceleracionY.LOW.data;
	data[11] = aceleracionZ.HIGH.data;
	data[12] = aceleracionZ.LOW.data;
	data[13] = velAngularX.HIGH.data;
	data[14] = velAngularX.LOW.data;
	data[15] = velAngularY.HIGH.data;
	data[16] = velAngularY.LOW.data;
	data[17] = velAngularZ.HIGH.data;
	data[18] = velAngularZ.LOW.data;
	data[19] = velLineal.HIGH.data;
	data[20] = velLineal.LOW.data;
	data[21] = angBrujula.HIGH.data;
	data[22] = angBrujula.LOW.data;
	data[23] = presenciaAgua.data;
	data[24] = cargaBaterias.data;
	data[25] = XOR.data;
	data[26] = finTrama.data;
}
